<!DOCTYPE html>
<html>
<title>MPG Calculator</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">

<body>
	<div class="container">

		<div class="form-group">
			<h1>Annual Fuel Cost Calculator</h1>
		</div>

		<div class="form-group">
			<h3>Distance</h3>
			<div class="form-row">
				<div class="form-col">
					<label>Weekly Miles</label>
					<input type="number" id="mi_weekly" name="mi_weekly" min="0" step=".01" placeholder="Miles">
				</div>
				<div class="form-col">
					<label>Annual Miles</label>
					<input type="number" id="mi_yearly" name="km_yearly" min="0" step=".01" placeholder="Miles">
				</div>
			</div>
			<div class="form-row">
				<div class="form-col">
					<label>Weekly Kilometers</label>
					<input type="number" id="km_weekly" name="km_weekly" min="0" step=".01" placeholder="KM">
				</div>
				<div class="form-col">
					<label>Annual Kilometers</label>
					<input type="number" id="km_yearly" name="km_yearly" min="0" step=".01" placeholder="KM">
				</div>
			</div>
		</div>

		<div class="form-group">
			<h3>Fuel Cost</h3>
			<div class="form-row">
				<div class="form-col">
					<label>Gasoline</label>
					<input type="number" id="gas" name="gas" min="0" max="1000" step=".001" placeholder="$ per gallon">
				</div>
				<div class="form-col">
					<label>Electricity</label>
					<input type="number" id="elec" name="elec" min="0" max="1000" step=".001"
						placeholder="&cent; per kWh">
				</div>
			</div>
		</div>


		<h1>Gasoline Vehicle</h1>
		<div class="form-group table">
			<div class="row">
				<div class="col">Name</div>
				<div class="col">MPG</div>
				<div class="col">Yearly Cost</div>
			</div>
			<div class="row">
				<div class="col"><input type="text" id="F1_name" placeholder="Year Make Model"></div>
				<div class="col"><input type="number" id="F1_mpg" min="0" step=".01" placeholder="gallons"></div>
				<div class="col"><input type="text" id="F1_cost" disabled placeholder="$0.00"></div>
			</div>
			<div class="row">
				<div class="col"><input type="text " id="F2_name" placeholder="Year Make Model"></div>
				<div class="col"><input type="number" id="F2_mpg" min="0" step=".01" placeholder="gallons"></div>
				<div class="col"><input type="text" id="F2_cost" disabled placeholder="$0.00"></div>
			</div>
			<div class="row">
				<div class="col"><input type="text" id="F3_name" placeholder="Year Make Model"></div>
				<div class="col"><input type="number" id="F3_mpg" min="0" step=".01" placeholder="gallons"></div>
				<div class="col"><input type="text" id="F3_cost" disabled placeholder="$0.00"></div>
			</div>
			<div class="row">
				<div class="col"><input type="text" id="F4_name" placeholder="Year Make Model"></div>
				<div class="col"><input type="number" id="F4_mpg" min="0" step=".01" placeholder="gallons"></div>
				<div class="col"><input type="text" id="F4_cost" disabled placeholder="$0.00"></div>
			</div>
		</div>

		<h1>Electric Vehicle</h1>
		<div class="form-group table">
			<div class="row">
				<div class="col">Name</div>
				<div class="col">Battery Size</div>
				<div class="col">Range</div>
				<div class="col">Yearly Cost</div>
			</div>
			<div class="row">
				<div class="col"><input type="text" id="E1_name" placeholder="Year Make Model"></div>
				<div class="col"><input type="number" id="E1_kwh" min="0" step=".01" placeholder="kWh"></div>
				<div class="col"><input type="number" id="E1_range" min="0" step=".01" placeholder="miles"></div>
				<div class="col"><input type="text" id="E1_cost" disabled placeholder="$0.00"></div>
			</div>
			<div class="row">
				<div class="col"><input type="text" id="E2_name" placeholder="Year Make Model"></div>
				<div class="col"><input type="number" id="E2_kwh" min="0" step=".01" placeholder="kWh"></div>
				<div class="col"><input type="number" id="E2_range" min="0" step=".01" placeholder="miles"></div>
				<div class="col"><input type="text" id="E2_cost" disabled placeholder="$0.00"></div>
			</div>
			<div class="row">
				<div class="col"><input type="text" id="E3_name" placeholder="Year Make Model"></div>
				<div class="col"><input type="number" id="E3_kwh" min="0" step=".01" placeholder="kWh"></div>
				<div class="col"><input type="number" id="E3_range" min="0" step=".01" placeholder="miles"></div>
				<div class="col"><input type="text" id="E3_cost" disabled placeholder="$0.00"></div>
			</div>
			<div class="row">
				<div class="col"><input type="text" id="E4_name" placeholder="Year Make Model"></div>
				<div class="col"><input type="number" id="E4_kwh" min="0" step=".01" placeholder="kWh"></div>
				<div class="col"><input type="number" id="E4_range" min="0" step=".01" placeholder="miles"></div>
				<div class="col"><input type="text" id="E4_cost" disabled placeholder="$0.00"></div>
			</div>
		</div>
	</div>

	<script src="js/cookie.js"></script>
	<script type="text/javascript">

		// Global Variables
		var gas_price = cookie.get("gas_price") ? cookie.get("gas_price") : 0;
		var elec_price = cookie.get("elec_price") ? cookie.get("elec_price") : 0;
		var yearly_miles = cookie.get("yearly_miles") ? cookie.get("yearly_miles") : 0;

		// Convert units
		var convert = {
			miles_to_km: function (miles) {
				return (miles * 1.60934).toFixed(2);
			},
			km_to_miles: function (km) {
				return (km / 1.60934).toFixed(2);
			}
		}

		// Calculate Yearly Costs
		var cost = {
			calculate: function () {
				for (let i = 1; i <= 4; i++) {
					cost.mpg(i);
					cost.mpge(i);
				}
			},
			mpg: function (i) {
				var mpg = document.getElementById("F" + i + "_mpg").value;
				if (Number(mpg) > 0) {
					var yearly_cost = gas_price * yearly_miles / mpg;
					document.getElementById("F" + i + "_cost").value = "$" + (yearly_cost).toFixed(2);
				}
				else {
					document.getElementById("F" + i + "_cost").value = "$0.00";
				}
			},
			mpge: function (i) {
				var kwh = document.getElementById("E" + i + "_kwh").value;
				var range = document.getElementById("E" + i + "_range").value;

				if (Number(kwh) > 0 && Number(range) > 0) {
					var yearly_cost = elec_price * .01 * yearly_miles / (range / kwh);
					document.getElementById("E" + i + "_cost").value = "$" + (yearly_cost).toFixed(2);
				}
				else {
					document.getElementById("E" + i + "_cost").value = "$0.00";
				}
			},
		};

		// Watch for variable changes
		var watch = {
			init: function () {
				for (let i = 1; i <= 4; i++) {
					watch.name(i);
					watch.mpg(i);
					watch.mpge(i);
				}
				watch.distance();
				watch.gas();
				watch.elec();
			},
			name: function (i) {
				document.getElementById("F" + i + "_name").addEventListener("keyup", function () {
					cookie.set("F" + i + "_name", this.value);
				});
				document.getElementById("E" + i + "_name").addEventListener("keyup", function () {
					cookie.set("E" + i + "_name", this.value);
				});
			},
			mpg: function (i) {
				document.getElementById("F" + i + "_mpg").addEventListener("keyup", function () {
					cost.mpg(i);
					cookie.set("F" + i + "_mpg", this.value);
				});
			},
			mpge: function (i) {
				document.getElementById("E" + i + "_kwh").addEventListener("keyup", function () {
					cost.mpge(i);
					cookie.set("E" + i + "_kwh", this.value);
				});
				document.getElementById("E" + i + "_range").addEventListener("keyup", function () {
					cost.mpge(i);
					cookie.set("E" + i + "_range", this.value);
				});
			},
			distance: function () {
				function setDistance(yearly_miles=0) {
					// Set the fields
					document.getElementById("mi_weekly").value = parseFloat((Number)(yearly_miles / 52).toFixed(2));
					document.getElementById("mi_yearly").value = parseFloat((Number)(yearly_miles).toFixed(2));
					document.getElementById("km_weekly").value = parseFloat((Number)(convert.miles_to_km(yearly_miles) / 52).toFixed(2));
					document.getElementById("km_yearly").value = parseFloat((Number)(convert.miles_to_km(yearly_miles)).toFixed(2));
					
					// Set the cookies
					cookie.set("weekly_miles", document.getElementById("mi_weekly").value);
					cookie.set("yearly_miles", document.getElementById("mi_yearly").value);
					cookie.set("weekly_km", document.getElementById("km_weekly").value);
					cookie.set("yearly_km", document.getElementById("km_yearly").value);

					cost.calculate();
				}
				document.getElementById("mi_weekly").addEventListener("keyup", function(){
					setDistance(this.value * 52);
				});
				document.getElementById("mi_yearly").addEventListener("keyup", function(){
					setDistance(this.value);
				});
				document.getElementById("km_weekly").addEventListener("keyup", function(){
					setDistance(convert.km_to_miles(this.value) / 52);
				});
				document.getElementById("km_yearly").addEventListener("keyup", function(){
					setDistance(convert.km_to_miles(this.value));
				});
			},
			gas: function () {
				document.getElementById("gas").addEventListener("keyup", function () {
					gas_price = this.value;
					cost.calculate();
					cookie.set("gas_price", this.value);
				});
			},
			elec: function () {
				document.getElementById("elec").addEventListener("keyup", function () {
					elec_price = this.value;
					cost.calculate();
					cookie.set("elec_price", this.value);
				});
			}
		};

		// Initialize the form
		function init(){

			// Load Cookie Data into the form
			for (let i = 1; i <= 4; i++) {
				document.getElementById("F" + i + "_name").value = cookie.get("F" + i + "_name");
				document.getElementById("F" + i + "_mpg").value = cookie.get("F" + i + "_mpg");
				document.getElementById("E" + i + "_name").value = cookie.get("E" + i + "_name");
				document.getElementById("E" + i + "_kwh").value = cookie.get("E" + i + "_kwh");
				document.getElementById("E" + i + "_range").value = cookie.get("E" + i + "_range");
			}
			document.getElementById("mi_weekly").value = cookie.get("weekly_miles");
			document.getElementById("km_weekly").value = cookie.get("weekly_km");
			document.getElementById("mi_yearly").value = cookie.get("yearly_miles");
			document.getElementById("km_yearly").value = cookie.get("yearly_km");
			document.getElementById("gas").value = cookie.get("gas_price");
			document.getElementById("elec").value = cookie.get("elec_price");

			// Initalize the watchers
			watch.init();

			// Calculate the yearly costs
			cost.calculate();
		}
		init();
	</script>

</body>
</html>